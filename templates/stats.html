{% extends "base.html" %}
{% block content %}

<h1 class="text-3xl font-bold mb-6 text-blue-300">Your Stats</h1>

<!-- Grid: 2 charts per row -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">

    <!-- Total Hours -->
    <div class="bg-gray-800 p-4 rounded shadow">
        <h2 class="text-xl font-bold mb-4">Total Hours</h2>
        <p class="text-4xl text-blue-400 font-bold">{{ total_hours|round(1) }}</p>
    </div>

    <!-- Rating Stats -->
    <div class="bg-gray-800 p-4 rounded shadow">
        <h2 class="text-xl font-bold mb-4">Ratings</h2>
        <p class="text-lg">
            Average Rating:
            <span class="text-yellow-400 font-bold text-2xl">
                {{ avg_rating|round(2) if avg_rating else "N/A" }}
            </span>
        </p>
        <p class="text-lg text-gray-300 mt-1">
            Rated Games:
            <span class="font-semibold text-gray-100">{{ rated_count }}</span>
        </p>
    </div>

    <!-- Hours by Tag -->
    <div class="bg-gray-800 p-6 rounded shadow">
        <h2 class="text-xl font-bold mb-4">Top Tags by Hours</h2>
        <canvas id="genreChart" style="max-height: 400px;"></canvas>
    </div>

    <!-- Games per Tag -->
    <div class="bg-gray-800 p-6 rounded shadow">
        <h2 class="text-xl font-bold mb-4">Top Tags by Count</h2>
        <canvas id="genrePieChart" style="max-height: 400px;"></canvas>
    </div>

    <!-- Games per Release Year -->
    <div class="bg-gray-800 p-4 rounded shadow h-64">
        <h2 class="text-xl font-bold mb-2">Games by Release Year</h2>
        <div class="h-48">
            <canvas id="gamesByYear"></canvas>
        </div>
    </div>

    <!-- Rating Distribution -->
    <div class="bg-gray-800 p-4 rounded shadow h-64">
        <h2 class="text-xl font-bold mb-2">Rating Distribution (1â€“10)</h2>
        <div class="h-48">
            <canvas id="ratingDist"></canvas>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // ================================
    // Hours by Tag
    // ================================
    const hoursGenreLabels = JSON.parse('{{ hours_tag_labels | tojson }}');
    const hoursGenreData = JSON.parse('{{ hours_tag_data | tojson }}');

    new Chart(document.getElementById('genreChart'), {
        type: 'bar',
        data: {
            labels: hoursGenreLabels,
            datasets: [{
                label: 'Hours',
                data: hoursGenreData,
                backgroundColor: 'rgba(54, 162, 235, 0.7)',
                borderColor: 'rgb(54, 162, 235)',
                borderWidth: 1
            }]
        },
        options: {
            indexAxis: 'y',
            plugins: { legend: { display: false } },
            responsive: true,
            scales: {
                x: { ticks: { color: "#ddd" }, beginAtZero: true },
                y: {
                    ticks: {
                        color: "#ddd",
                        autoSkip: false,
                        maxRotation: 0,
                        minRotation: 0,
                        font: { size: 12 }
                    }
                }
            }
        }
    });

    // ================================
    // Games per Tag
    // ================================
    const genreLabels = JSON.parse('{{ tag_labels | tojson }}');
    const genreData = JSON.parse('{{ tag_data | tojson }}');

    new Chart(document.getElementById('genrePieChart'), {
        type: 'bar',
        data: {
            labels: genreLabels,
            datasets: [{
                label: 'Games',
                data: genreData,
                backgroundColor: 'rgba(255, 159, 64, 0.7)',
                borderColor: 'rgb(255, 159, 64)',
                borderWidth: 1
            }]
        },
        options: {
            indexAxis: 'y',
            plugins: { legend: { display: false } },
            responsive: true,
            scales: {
                x: { ticks: { color: "#ddd" }, beginAtZero: true },
                y: {
                    ticks: {
                        color: "#ddd",
                        autoSkip: false,
                        maxRotation: 0,
                        minRotation: 0,
                        font: { size: 12 }
                    }
                }
            }
        }
    });

    // ================================
    // Games per Release Year
    // ================================
    new Chart(document.getElementById("gamesByYear"), {
        type: "line",
        data: {
            labels: {{ year_labels | tojson }},
            datasets: [{
                label: "Games Released",
                data: {{ year_counts | tojson }},
                fill: false,
                borderColor: "rgb(75, 192, 192)",
                tension: 0.2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: { y: { beginAtZero: true } }
        }
    });

    // ================================
    // Rating Distribution
    // ================================
    new Chart(document.getElementById("ratingDist"), {
        type: "bar",
        data: {
            labels: {{ rating_labels | tojson }},
            datasets: [{
                label: "Games",
                data: {{ rating_counts | tojson }},
                backgroundColor: "rgba(153, 102, 255, 0.7)"
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: { y: { beginAtZero: true } }
        }
    });
</script>

{% endblock %}
